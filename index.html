// ===========================================
 // DOGET: expone JSON según parámetro “tipo”
 // ===========================================
 function doGet(e) {
   const tipo = (e.parameter.tipo || 'kpi').toLowerCase();
   let payload;
 
   switch (tipo) {
     case 'kpi':
       payload = getKPIData();
       break;
     case 'faltantes':
       payload = getFaltantesData();
       break;
     default:
       return ContentService
         .createTextOutput(JSON.stringify({ error: 'tipo inválido' }))
         .setMimeType(ContentService.MimeType.JSON);
   }
 
   return ContentService
     .createTextOutput(JSON.stringify({ tipo, datos: payload }))
     .setMimeType(ContentService.MimeType.JSON);
 }
 
 // ===========================================
 // Lee KPIs actuales desde "ventas generales"
 // ===========================================
 function getKPIData() {
   const hoja = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('ventas generales');
 
   const kpis = hoja.getRange('Q2:W9').getValues(); // KPIs parte superior
   const lista = [];
 
   for (let i = 0; i < kpis.length; i++) {
     const fila = kpis[i];
     const kpi = fila[0];
     lista.push({
       kpi,
       valor100: fila[1],
       valor125: fila[2],
       valor70: fila[3],
       resultado: fila[4],
       arrastre: fila[5],
       total: fila[6]
     });
   }
 
   return lista;
 }
 
 // =====================================================
 // Lee cuánto falta para metas (desde fila 15 en adelante)
 // =====================================================
 function getFaltantesData() {
   const hoja = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('ventas generales');
   const faltantes = hoja.getRange('Q15:T21').getValues(); // Asegúrate del rango correcto
   const lista = [];
 
   for (let i = 0; i < faltantes.length; i++) {
     const fila = faltantes[i];
     const kpi = fila[0];
     if (!kpi) continue;
 
     lista.push({
       kpi,
       faltante100: fila[1],
       faltante150: fila[2],
       faltante250: fila[3],
     });
   }
 
   return lista;
 }
